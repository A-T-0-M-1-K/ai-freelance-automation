groups:
  - name: memory_alerts
    rules:
      - alert: HighRAMUsage
        expr: system_ram_percent > 80
        for: 5m
        labels:
          severity: warning
          team: devops
        annotations:
          summary: "Высокое использование RAM на {{ $labels.instance }}"
          description: "Использование оперативной памяти превышает 80% в течение 5 минут. Текущее значение: {{ $value }}%"

      - alert: CriticalRAMUsage
        expr: system_ram_percent > 90
        for: 2m
        labels:
          severity: critical
          team: devops
        annotations:
          summary: "КРИТИЧЕСКОЕ использование RAM на {{ $labels.instance }}"
          description: "Использование оперативной памяти превышает 90% в течение 2 минут. Текущее значение: {{ $value }}%. Требуется немедленное вмешательство!"

      - alert: HighGPUMemoryUsage
        expr: system_gpu_percent > 85
        for: 5m
        labels:
          severity: warning
          team: ml-engineering
        annotations:
          summary: "Высокое использование видеопамяти GPU на {{ $labels.instance }}"
          description: "Использование видеопамяти превышает 85% в течение 5 минут. Текущее значение: {{ $value }}%"

      - alert: CriticalGPUMemoryUsage
        expr: system_gpu_percent > 95
        for: 1m
        labels:
          severity: critical
          team: ml-engineering
        annotations:
          summary: "КРИТИЧЕСКОЕ использование видеопамяти GPU на {{ $labels.instance }}"
          description: "Использование видеопамяти превышает 95% в течение 1 минуты. Текущее значение: {{ $value }}%. Риск сбоя обработки ИИ-задач!"

      - alert: MemoryLeakDetected
        expr: |
          (avg_over_time(system_ram_percent[30m]) - avg_over_time(system_ram_percent[60m])) > 10
        for: 10m
        labels:
          severity: warning
          team: development
        annotations:
          summary: "Обнаружена потенциальная утечка памяти на {{ $labels.instance }}"
          description: "Использование RAM выросло на более чем 10% за последние 30 минут по сравнению с предыдущим часом. Требуется анализ кода."

      - alert: SwapUsageHigh
        expr: (100 * (node_memory_SwapTotal_bytes - node_memory_SwapFree_bytes) / node_memory_SwapTotal_bytes) > 50
        for: 10m
        labels:
          severity: warning
          team: devops
        annotations:
          summary: "Высокое использование swap на {{ $labels.instance }}"
          description: "Использование swap превышает 50%. Это указывает на нехватку оперативной памяти. Текущее значение: {{ $value }}%"

      - alert: ModelLoadingSlow
        expr: rate(ai_model_load_duration_seconds_sum[5m]) > 30
        for: 2m
        labels:
          severity: warning
          team: ml-engineering
        annotations:
          summary: "Медленная загрузка моделей ИИ на {{ $labels.instance }}"
          description: "Среднее время загрузки моделей превышает 30 секунд. Это может указывать на проблемы с диском или нехватку памяти."

      - alert: CacheHitRatioLow
        expr: (rate(cache_hits_total[5m]) / rate(cache_operations_total[5m])) < 0.7
        for: 10m
        labels:
          severity: warning
          team: development
        annotations:
          summary: "Низкий коэффициент попаданий в кэш на {{ $labels.instance }}"
          description: "Коэффициент попаданий в кэш ниже 70% в течение 10 минут. Рассмотрите увеличение размера кэша или оптимизацию стратегии кэширования."